<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>YiGuo订单管理</title>
  <link rel="stylesheet" href="../css/jquery.page.css">
  <link rel="stylesheet" href="../layui/css/layui.css">
  <link rel="stylesheet" href="../css/shade.css">
  <script src="../js/jquery-1.10.1.min.js"></script>
  <script src="../js/common.js"></script>
  <script src="../js/public.js"></script>
  <script type="text/javascript" src="../layui/layui.js"></script>
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo">YiGuo后台管理</div>
      <!-- 头部区域（可配合layui已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item">
          <a href="">控制台</a>
        </li>
        <li class="layui-nav-item">
          <a href="">商品管理</a>
        </li>
        <li class="layui-nav-item">
          <a href="">用户</a>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">其它系统</a>
          <dl class="layui-nav-child">
            <dd>
              <a href="">邮件管理</a>
            </dd>
            <dd>
              <a href="">消息管理</a>
            </dd>
            <dd>
              <a href="">授权管理</a>
            </dd>
          </dl>
        </li>
      </ul>
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item">
          <a href="javascript:;">
              <i class="layui-icon" style='padding-right: 10px;'>&#xe770;</i> <span>贤心</span>
          </a>
          <dl class="layui-nav-child">
            <dd>
              <a href="">基本资料</a>
            </dd>
            <dd>
              <a href="">安全设置</a>
            </dd>
          </dl>
        </li>
        <li class="layui-nav-item outName">
          <a href="">退了</a>
        </li>
      </ul>
    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
        <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
        <ul class="layui-nav layui-nav-tree" lay-filter="test">
          <li class="layui-nav-item ">
            <a class="" href="javascript:;">商品管理</a>
            <dl class="layui-nav-child">
              <dd>
                <a href="goodsList.html">商品列表</a>
              </dd>
              <dd>
                <a href="goodsCategory.html">商品分类</a>
              </dd>
              <dd>
                <a href="addGoods.html">添加商品</a>
              </dd>
              <!-- <dd><a href="">超链接</a></dd> -->
            </dl>
          </li>
          <li class="layui-nav-item">
            <a href="javascript:;">用户管理</a>
            <dl class="layui-nav-child">
              <dd>
                <a href="userList.html">用户列表</a>
              </dd>
              <dd>
                <a href="addUsers.html">添加用户</a>
              </dd>
            </dl>
          </li>
          <li class="layui-nav-item layui-nav-itemed">
            <a href="javascript:;">订单管理</a>
            <dl class="layui-nav-child">
              <dd>
                <a href="orderList.html">订单列表</a>
              </dd>
            </dl>
          </li>
          <!--  <li class="layui-nav-item"><a href="">云市场</a></li>
                      <li class="layui-nav-item"><a href="">发布商品</a></li> -->
        </ul>
      </div>
    </div>
    <div class="layui-body">
    <!-- 右侧内容 -->
    <div style='margin:40px 0 0 50px'>
        <button class="layui-btn allDel">
            <i class="layui-icon">&#xe640;</i> 删除
          </button>
          <table class="layui-table" style="width:900px;margin-top: 30px">
              <thead>
                <tr>
                  <th ><input type="checkbox" name=""  lay-skin="primary" style='width:50px;cursor: pointer;' id='checkedAll'> </th>
                  <th style="width:180px;text-align: center">商品名称</th>
                  <th style="width:100px;text-align: center">价格（元）</th>
                  <th style="width:100px;text-align: center">销量</th>
                  <th style="width:180px;text-align: center">订单总额（元）</th>
                  <th style="width:180px;text-align: center">下单时间</th>
                  <th style="width:90px;text-align: center">操作</th>
                </tr> 
              </thead>
              <tbody class='tbody' id='tboay'>
                  <!-- <tr>
                      <td><input type="checkbox" name=""  lay-skin="primary"style='width:50px;cursor: pointer;'> </td>
                      <td style="text-align: center">草莓</td>
                      <td style="text-align: center">22</td>
                      <td style="text-align: center">55</td>
                      <td style="text-align: center">1111</td>
                      <td style="text-align: center">2018.10.22</td>
                      <td>
                          <button class="layui-btn layui-btn-sm" style='margin-left: 20px'>
                              <i class="layui-icon">&#xe640;</i>
                            </button>
                      </td>
                    </tr> -->
              </tbody>
            </table>
            <div class="layui-footer" style='background: #009688;color:#fff;height: 20px;line-height: 20px;font-size: 12px;'>
              <!-- 底部固定区域 -->
              © YiGuo.com - 易果生鲜 - 订单列表
            </div>
          </div>
</div>
  

    <script>

    //JavaScript代码区域
    layui.use('element', function(){
      var element = layui.element;
      
    });
    
    //Demo
    layui.use('form', function(){
      var form = layui.form;
      
      //监听提交
      form.on('submit(formDemo)', function(data){
        layer.msg(JSON.stringify(data.field));
        return false;
      });
    });
//用户名渲染
// let users = localStorage.getItem('users');
// console.log(JSON.parse(users).name);
// let _name=JSON.parse(users).name;
// showUsername(_name);
// //用户退出
// outUsername(_name);

//-------------------获取列表数据-----------------------
    (()=>{
      
     
      //ajax获取数据
      let xhr = new XMLHttpRequest();
      xhr.onload = () =>{
        let res = JSON.parse(xhr.responseText);
        //console.log(res);
        dataS(res);//数据渲染

//------------删除当行---------------------------------------
        $('.layui-btn-sm').on('click',function(){
          var currentTr = $(this).parent().parent();
          // 获取点击对象id
          var currentId = currentTr.attr('data-id');
          let xhr = new XMLHttpRequest();
          xhr.onload = () =>{
            // let res = JSON.parse(xhr.responseText);
          }
          xhr.open('post','/order',true);
          xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
          let daTa = `id=${currentId}`
          xhr.send(daTa);
          var resDel = confirm('你确定要删除？');
          if(resDel){
            currentTr.remove();
           }
            
        })
      }
     
//-------------------全选、不选--------------------------------
      $('#checkedAll').on('click', function () {
              if ($(this).prop('checked')) {
                  $('.onechecked').prop('checked', 'checked');
              } else {
                  $('.onechecked').removeAttr('checked');
              };
          }); 
 //---------全删------------------------------------------
  $('.allDel').on('click',function(){
        $("input:checkbox:checked").each(function() {
              $(this).parent().parent().remove();
              var currentAllTr = $(this).parent().parent();
              // 获取点击对象id
              var currentAllId = currentAllTr.attr('data-id');
              // console.log(currentAllId);获取点击对应对象id
              let xhr = new XMLHttpRequest();
              xhr.onload = () =>{
                // let res = JSON.parse(xhr.responseText);
              }
              xhr.open('post','/order',true);
              xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
              let daTa = `id=${currentAllId}`
              xhr.send(daTa);
              });
              var resDels = confirm('你确定要删除？');
              if(resDels){
                currentAllTr.remove();
              }
        });
      xhr.open('get','/order',true);
      xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
      xhr.send();

    })();
//--------------数据渲染封装data(res)-----------------------------------
    function dataS(res){
      let tbody = document.querySelector('.tbody');
      var res1 = res.map(function(item){
        var numall = item.price*item.sale;
        // console.log(numall)
            return `
            <tr data-id=${item.id}>
                      <td><input type="checkbox" name="text"  lay-skin="primary" style='width:50px;cursor: pointer;' class='onechecked'> </td>
                      <td style="text-align: center">${item.name}</td>
                      <td style="text-align: center">￥${item.price}</td>
                      <td style="text-align: center">${item.sale}</td>
                      <td style="text-align: center">${numall}</td>
                      <td style="text-align: center">${item.time}</td>
                      <td>
                          <button class="layui-btn layui-btn-sm" style='margin-left: 20px'>
                              <i class="layui-icon btn-icon">&#xe640;</i>
                            </button>
                      </td>
              </tr>
                  `
        }).join('');
        tbody.innerHTML = res1;
    }
  // 通过cookie设置头部的用户名显示,如果不是登录状态，都跳转到登陆页面
login();
 //点击Logo跳转到首页
  index();
    </script>
</body>

</html>